<div class='page-header'>
  <div class="container">
    <h1>Case Number <%= @case.id%></h1>
    <%= link_to 'Edit Case', edit_case_path(@case), class: 'btn btn-primary' %>

    <%- if @case.status == "Pending" %>
      <%= link_to 'Close Case', close_case_path(@case), method: :put, class: 'btn btn-primary' %>
    <%end%>
    <% if current_user.is_admin? %>
       <%= link_to 'Reassign Case', reassign_admin_case_path(@case), remote: true, class: 'btn btn-primary' %>
    <% end %>

  </div>
</div>

<div class="container">
  <div class="row">

    <!-- BEGIN LEFT COLUMN -->
    <div class="col-md-9">
      <!-- BEGIN CASE INFORMATION -->
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3>Case Information</h3>
        </div>
        <div class="table-responsive">
          <table class="table table-default">
            <tbody>
              <tr>
                <td>Case Type</td>
                <td><%= @case.case_type %></td>
              </tr>
              <tr>
                <td>Status</td>
                <td><%= @case.status %></td>
              </tr>
              <tr>
                <td>Assigned To</td>
                <td id='assigned_user'><%= @case.user.name %></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <!-- END CASE INFORMATION -->
      <!-- BEGIN ISSUES -->
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3>Related Issues</h3>
        </div>

        <div class="panel-body">
          <div class="table-responsive">
            <table class="table table-default">
              <thead>
                <th>Description</th>
                <th>Tagged To</th>
              </thead>
              <tbody>
                  <%- @issues.order('id ASC').each do |i| %>
                  <tr>
                    <td class='col-md-3'><%= i.description %></td>
                    <td class='col-md-3'><%= i.tag.name %></td>
                  </tr>
                  <%- end %>
                </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- END ISSUES -->
      <!-- BEGIN RELATED PEOPLE -->
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3>Related People</h3>
        </div>
        <ul class="list-group">
          <% @case.people.each do |p| %>
            <li class="list-group-item">
              <p><%= p.name %></p>
            </li>
          <% end %>
        </ul>
        <%= link_to 'Add Person', new_case_involvement_path(@case), class: 'btn btn-primary', remote: true %>
      </div>
      <!-- END RELATED PEOPLE -->
      <!-- BEGIN FOLLOW UP -->

      <div class="panel panel-default">
        <div class="panel-heading">
          <div class="row">
            <div class="col-md-3">
              <h3>Follow Ups</h3>
            </div>            
            <div class="col-md-2">
              <%= link_to "Add Follow Up", new_case_follow_up_path(@case), class: 'btn btn-primary' %>
            </div>            
          </div>
        </div>

        <div class="panel-body">
          <div class="table-responsive">
            <table class="table table-default">
              <thead>
                <th>Date</th>
                <th>Description</th>
                <th>Created By</th>
              </thead>
              <tbody>
                  <%- @case.follow_ups.each do |fu| %>
                  <tr>
                    <td class='col-md-2'><%= fu.created_at.to_date.to_formatted_s(:rfc822)%></td>
                    <td class='col-md-7'><%= fu.description %></td>
                    <td class='col-md-3'><%= fu.user.name %></td>
                  </tr>
                  <%- end %>
                </tbody>
            </table>
          </div>
        </div>
      </div>
      <!-- END FOLLOW UP -->

    </div>
    <!-- END LEFT COLUMN -->
    <!-- BEGIN FILES -->
    <div class="col-md-3">
      <div class="panel panel-default">

        <div class="panel-heading">
          <h3>Files</h3>
        </div>

        <ul id='links' class="list-group">
          <% @case.links.each do |i| %>
            <li class="list-group-item">
              <%= link_to i.filename, i.url %>
            </li>
          <% end %>
        </ul>

        <div class="panel-body">
          <%= form_for([@case, @case.links.build], url: case_links_path(@case)) do |f| %>
            <input id='caseId' type='hidden' data-case-id='<%= @case.id %>'>
            <input id='upload' type='button' class='btn btn-primary btn-block' value='Upload New File'>
          <% end %>
        </div>

      </div>
    </div>
    <!-- END FILES -->

  </div>
</div>
