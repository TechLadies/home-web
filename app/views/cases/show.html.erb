<div class='page-header'>

  <div class="container">
    <h1>Case #<%= @case.id %></h1>
    <%= link_to 'Edit Case', edit_case_path(@case), class: 'btn btn-default' %>
    <%= link_to 'Close Case', close_case_path(@case), method: :put, class: 'btn btn-danger' if @case.pending? %>
  </div>

  <!-- *Case Information -->
  <div class='page-header-list'>
    <div class='container'>
      <ul class="list-inline">

        <li>
          <span>Case Type</span>
          <strong><%= @case.case_type %></strong>
        </li>

        <li>
          <span>Status</span>
          <strong><%= @case.status %></strong>
        </li>

        <li>
          <span>Assigned To</span>
          <strong><%= @case.user.name %></strong>
          <%= link_to 'Reassign', reassign_admin_case_path(@case), remote: true, class: 'btn btn-primary btn-sm' if current_user.is_admin? %>
        </li>

      </ul>
    </div>
  </div>
  <!-- Case Information* -->

</div>

<!-- BEGIN MAIN CLIENT/EMPLOYER -->
<div class="container">  
  <div class="panel panel-default">

    <div class="panel-heading">
      <div class="row">
        <div class="col-md-6">
          <h2>Client</h2>
        </div>
        <div class="col-md-6">
          <h2>Employer</h2>
        </div>
      </div>
    </div>

    <div class="panel-body">
      <div class="row">

        <!-- RELATED PEOPLE: CLIENT -->
        <div id='client-info' class="col-md-6">
          <%- if @case.client.nil? %>
            <div class='well well-empty text-center'>
              <p>No client information yet.</p>
              <%= link_to 'Add Client', new_case_involvement_path(@case, involvement: { role: :client, involvable_type: 'Person' }), remote: true, class: 'btn btn-success' %>
            </div>
          <%- else %>
            <%= render partial: 'person', object: @case.client.involvable, locals: { involvement: @case.client } %>
          <%- end %>
        </div>

        <!-- RELATED PEOPLE/ORG: EMPLOYER) -->
        <div id='employer-info' class="col-md-6">
          <%- if @case.employer.nil? %>
            <div class='well well-empty text-center'>
              <p>No employer information yet.</p>
              <%= link_to 'Add Person', new_case_involvement_path(@case, involvement: { role: :employer, involvable_type: 'Person' }), remote: true, class: 'btn btn-success' if @case.domestic? %>
              <%= link_to 'Add Organization', new_case_involvement_path(@case, involvement: { role: :employer, involvable_type: 'Organization' }), remote: true, class: 'btn btn-success'  if @case.non_domestic? %>
            </div>
          <%- else %>
            <%= render partial: @case.employer.involvable.class.to_s.downcase, object: @case.employer.involvable, locals: { involvement: @case.employer } %>
          <%- end %>
        </div>

      </div>
    </div>

  </div>
</div>
<!-- END RELATED CLIENT/EMPLOYER -->

<div class='container'>
  <div class="panel panel-default">
    <div class='panel-body'>

      <!-- *Tabs -->
      <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active">
          <a href="#issues" aria-controls="pending" role="tab" data-toggle="tab">
            <span>Issues</span>
            <span class="badge"><%= @issues.count %></span>            
          </a>
        </li>

        <li role="presentation">
          <a href="#followups" aria-controls="followups" role="tab" data-toggle="tab">
            <span>Follow Ups</span>
            <span class="badge"><%= @case.follow_ups.count %></span>            
          </a>
        </li>

        <li role="presentation">
          <a href="#related" aria-controls="related" role="tab" data-toggle="tab">
            <span>People/Organizations</span>
            <span class="badge"><%= @case.others.count %></span>
          </a>
        </li>

        <li role="presentation">
          <a href="#documents" aria-controls="documents" role="tab" data-toggle="tab">
            <span>Documents</span>
            <span class="badge"><%= @case.links.count %></span>
          </a>
        </li>
      </ul>
      <!-- Tabs* -->

      <!-- *Tab Content -->
      <div class="tab-content">

        <!-- ISSUES -->
          <div role="tabpanel" class="tab-pane active table-responsive" id="issues">
            <ul class='list-group'>
              <%- @issues.order('id ASC').each do |i| %>
                <li class='list-group-item'>
                  <strong><%= i.tag.name %></strong>
                  <p><%= i.description %></p>
                </li>
              <%- end %>
            </ul>
          </div>
        <!-- ISSUES -->

        <!-- FOLLOW UPS -->
        <div role="tabpanel" class="tab-pane table-responsive" id="followups">
          <table class="table table-default">
            <thead>
              <th>Date</th>
              <th>Description</th>
              <th>Created By</th>
            </thead>
            <tbody>
              <%- @case.follow_ups.order(created_at: :desc).each do |follow_up| %>
                <tr>
                  <td><%= follow_up.created_at.to_date.to_formatted_s(:long) %></td>
                  <td><%= follow_up.description %></td>
                  <td><%= follow_up.user.name %></td>
                </tr>
              <%- end %>
            </tbody>
          </table>
          <hr/>
          <%= link_to "Add Follow Up", new_case_follow_up_path(@case), class: 'btn btn-success pull-right', remote: true %>
        </div>
        <!-- FOLLOW UPS -->

        <!-- PPL/ORG -->
        <div role="tabpanel" class="tab-pane table-responsive" id="related">

          <table id='others-info' class="table table-default">
            <thead>
              <th>Name</th>
              <th>Contact number</th>
              <th>Email</th>
              <th></th>
            </thead>
            <tbody>
              <%= render partial: 'other', collection: @case.others %>
            </tbody>
          </table>

          <hr/>

          <div class='pull-right'>
            <%= link_to 'Add Person', new_case_involvement_path(@case, involvement: { role: :others, involvable_type: 'Person' }), remote: true, class: 'btn btn-success' %>
            <%= link_to 'Add Organization', new_case_involvement_path(@case, involvement: { role: :others, involvable_type: 'Organization' }), remote: true, class: 'btn btn-success' %>
          </div>

        </div>
        <!-- PPL/ORG -->

        <!-- FILES -->
        <div role="tabpanel" class="tab-pane" id="documents">

          <div class="row">
            <%- @case.links.each do |i| %>
              <div class="col-sm-6 col-md-4">
                <div class="thumbnail">
                  <%= filepicker_image_tag i.url, w: 350, h: 250, fit: 'crop', alt: i.filename %> 
                  <div class="caption">
                    <p><%= i.filename %></p>
                    <%= link_to 'Download', i.url, class: 'btn btn-default'%>
                  </div>
                </div>
              </div>
            <%- end %>
          </div>

          <hr />

          <%= form_for [@case, @case.links.build], url: case_links_path(@case) do |f| %>
            <div class='pull-right'>
              <%= f.filepicker_field :url, onchange: 'onPhotoUpload(event)' %>
            </div>
            <%= f.hidden_field :filename, as: :hidden %>
            <%= f.hidden_field :mimetype, as: :hidden %>
            <%= f.hidden_field :size, as: :hidden %>
          <%- end %>

        </div>
        <!-- FILES -->

      </div>
      <!-- Tab Content -->

    </div>
  </div>
</div>

